<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BioHacker v19: Date Control</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, setDoc, updateDoc, collection, query, orderBy, limit, onSnapshot, addDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD1xdMdcbHXgGAL008bdmq22SNgLVcC9jM",
            authDomain: "appweb-entrenamiento.firebaseapp.com",
            projectId: "appweb-entrenamiento",
            storageBucket: "appweb-entrenamiento.firebasestorage.app",
            messagingSenderId: "199318318696",
            appId: "1:199318318696:web:04c592f117296e375215dd"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- DATOS EDU GARCIA & CONFIG ---
        const EXERCISES = {
            pushups: { name: "Flexiones", rest: 60, img: "https://images.unsplash.com/photo-1599058945522-28d584b6f0ff?q=80&w=400&auto=format&fit=crop", desc: "Tri√°ngulo cabeza-manos. Codos flecha.", video: "https://www.youtube.com/watch?v=E6a_g8FTPoQ" },
            squats: { name: "Sentadillas", rest: 90, img: "https://images.unsplash.com/photo-1574680096145-d05b474e2155?q=80&w=400&auto=format&fit=crop", desc: "Tr√≠pode plantar. Rodillas siguen pies.", video: "https://www.youtube.com/watch?v=J9x0ffVL5rg" },
            lunges: { name: "Zancadas", rest: 60, img: "https://images.unsplash.com/photo-1434608519344-49d77a699ded?q=80&w=400&auto=format&fit=crop", desc: "Paso fluido. Aterriza suave.", video: "https://www.youtube.com/results?search_query=edugarcia_trainer+zancadas+fuerza" },
            plank: { name: "Plancha", rest: 45, img: "https://plus.unsplash.com/premium_photo-1672046218038-f86a978f85f3?q=80&w=400&auto=format&fit=crop", desc: "Empuja suelo. Gl√∫teo fuerte.", video: "https://www.youtube.com/watch?v=_OlSElUXU2w" },
            burpees: { name: "Burpees", rest: 90, img: "https://images.unsplash.com/photo-1599058945522-28d584b6f0ff?q=80&w=400&auto=format&fit=crop", desc: "Fluidez, no impacto.", video: "https://www.youtube.com/results?search_query=edugarcia_trainer+levantarse+suelo" },
            row: { name: "Remo/Dominada", rest: 90, img: "https://images.unsplash.com/photo-1598289431512-b97b0917affc?q=80&w=400&auto=format&fit=crop", desc: "Retracci√≥n escapular.", video: "https://www.youtube.com/shorts/sMhAi0eTlMA" }
        };

        const WORKOUT_ORDER = ["Torso", "Aer√≥bico", "Pierna", "Aer√≥bico", "Full Body"];
        const ROUTINES = {
            "Torso": ["pushups", "row", "plank"],
            "Pierna": ["squats", "lunges", "plank"],
            "Full Body": ["burpees", "squats", "pushups"],
            "Aer√≥bico": [], "Trekking": []
        };

        // --- ESTILOS ---
        const styles = `
            :root { --primary: #0a84ff; --bg: #000; --card: #1c1c1e; --text: #fff; --accent: #32d74b; --warning: #ffd60a; --danger: #ff453a; }
            body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; padding-bottom: 120px; }
            
            .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; position: sticky; top: 0; background: var(--bg); z-index: 50; padding: 10px 0; border-bottom: 1px solid #111; }
            .global-timer { font-family: monospace; font-size: 24px; font-weight: 700; color: #666; background: #111; padding: 8px 16px; border-radius: 8px; border: 1px solid #222; min-width: 80px; text-align: center; }
            .global-timer.active { color: var(--primary); border-color: var(--primary); animation: pulse 2s infinite; }
            @keyframes pulse { 0% {box-shadow: 0 0 0 rgba(10,132,255,0);} 50% {box-shadow: 0 0 15px rgba(10,132,255,0.2);} 100% {box-shadow: 0 0 0 rgba(10,132,255,0);} }

            .ex-card { display: flex; align-items: center; background: #1c1c1e; margin-bottom: 12px; border-radius: 12px; overflow: hidden; padding-right: 15px; border: 1px solid #333; position: relative; }
            .ex-img { width: 85px; height: 85px; object-fit: cover; margin-right: 15px; cursor: pointer; }
            .ex-hint { position: absolute; bottom: 5px; left: 5px; font-size: 9px; background: rgba(0,0,0,0.7); padding: 2px 5px; border-radius: 4px; pointer-events: none; color: white; }
            .ex-info { flex: 1; }
            .ex-name { font-weight: bold; font-size: 16px; margin-bottom: 4px; }
            .ex-meta { font-size: 13px; color: #888; display: flex; gap: 10px; }
            .tag-rest { color: var(--warning); font-weight: 600; }
            
            .sticky-action { position: fixed; bottom: 80px; left: 15px; right: 15px; z-index: 90; }
            .btn-start { width: 100%; background: var(--accent); color: #000; font-weight: 900; padding: 18px; border-radius: 16px; border: none; font-size: 18px; box-shadow: 0 5px 20px rgba(50, 215, 75, 0.4); cursor: pointer; text-transform: uppercase; letter-spacing: 1px; }
            
            .stat-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 25px; }
            .stat-box { background: #1c1c1e; padding: 15px 10px; border-radius: 12px; text-align: center; border: 1px solid #333; }
            .stat-num { font-size: 22px; font-weight: 900; color: var(--primary); display: block; }
            .stat-label { font-size: 10px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; }
            .chart-container { background: #1c1c1e; border-radius: 16px; padding: 15px; border: 1px solid #333; margin-bottom: 20px; }
            .chart-title { font-size: 14px; font-weight: bold; color: white; margin-bottom: 15px; display: flex; justify-content: space-between; }
            
            .active-panel { background: #111; border: 1px solid var(--primary); padding: 20px; border-radius: 16px; margin-bottom: 25px; display: none; }
            .active-panel.visible { display: block; }
            .rest-display { font-size: 40px; font-family: monospace; text-align: center; color: #fff; margin: 15px 0; font-weight: bold; }
            .rest-controls { display: flex; gap: 8px; justify-content: center; }
            .rest-controls button { background: #2c2c2e; color: white; border: 1px solid #444; padding: 12px; border-radius: 10px; flex: 1; font-weight: bold; }
            
            .finish-card { display: none; margin-top: 30px; background: #1c1c1e; padding: 20px; border-radius: 20px; border: 1px solid #333; }
            .finish-card.visible { display: block; }
            .form-row { display: flex; gap: 10px; margin-top: 10px; }
            input, select { width: 100%; padding: 14px; background: #000; border: 1px solid #444; color: #fff; border-radius: 10px; box-sizing: border-box; font-size: 16px; }
            label { font-size: 11px; color: #888; text-transform: uppercase; margin-bottom: 4px; display: block; margin-top: 15px;}
            .section-header { font-size: 12px; color: var(--primary); font-weight: bold; margin-top: 25px; border-bottom: 1px solid #333; padding-bottom: 5px; margin-bottom: 5px; }
            
            .btn-save { width: 100%; background: var(--primary); color: white; padding: 16px; border: none; border-radius: 12px; font-weight: bold; margin-top: 25px; font-size: 16px; cursor: pointer; }
            .btn-save.update { background: #ff9f0a; color: black; }
            
            .hr-zone { background: rgba(10, 132, 255, 0.1); border: 1px solid var(--primary); padding: 15px; border-radius: 12px; margin-bottom: 20px; text-align: center; display: none; }
            .hr-val { font-size: 24px; font-weight: 900; color: var(--primary); display: block; margin-top: 5px; }
            .tomorrow-box { margin-top: 40px; padding: 20px; border-top: 1px solid #333; opacity: 0.8; }
            .mini-grid { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; margin-top: 10px; }
            .mini-ex { flex: 0 0 60px; text-align: center; font-size: 10px; }
            .mini-img { width: 50px; height: 50px; border-radius: 10px; object-fit: cover; margin-bottom: 5px; border: 1px solid #444; }
            
            .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 200; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
            .modal-content { background: #1c1c1e; width: 85%; max-width: 400px; padding: 30px; border-radius: 20px; border: 1px solid #444; text-align: center; position: relative; }
            .close-modal { position: absolute; top: 15px; right: 20px; font-size: 28px; color: #888; background: none; border: none; cursor: pointer; }
            .btn-video { display: block; width: 100%; background: #ff0000; color: white; text-decoration: none; padding: 14px; border-radius: 12px; margin-top: 20px; font-weight: bold; }
            
            .hidden { display: none !important; }
            .tab-bar { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(20,20,20,0.95); display: flex; padding: 15px; border-top: 1px solid #333; z-index: 100; }
            .tab-btn { flex: 1; background: none; border: none; color: #666; font-weight: 700; font-size: 11px; }
            .tab-btn.active { color: var(--primary); }
        `;
        const styleSheet = document.createElement("style"); styleSheet.innerText = styles; document.head.appendChild(styleSheet);

        // --- ESTADO ---
        let userLevel = 1; let userWeight = 72; let userAge = 30;
        let currentReps = 10;
        let todayType = "Torso"; let tomorrowType = "Aer√≥bico";
        let startTime = 0; let globalInterval = null; let restInterval = null; let editingId = null; 

        window.initApp = async () => {
            onSnapshot(doc(db, "userStats", "global"), (d) => {
                if(d.exists()) {
                    const data = d.data();
                    userLevel = data.level || 1; userWeight = data.weight || 72; userAge = data.age || 0;
                    currentReps = userLevel === 1 ? 10 : (userLevel === 2 ? 12 : 15);
                    if(document.getElementById('inp-age')) document.getElementById('inp-age').value = userAge || "";
                }
            });

            onSnapshot(query(collection(db, "workouts"), orderBy("date", "desc"), limit(20)), (snap) => {
                const logs = snap.docs.map(d => ({id:d.id, ...d.data()}));
                calculateSchedule(logs);
                renderSession();
                renderAnalytics(logs);
            });
        };

        function calculateSchedule(logs) {
            if (logs.length === 0) {
                todayType = WORKOUT_ORDER[0];
            } else {
                const lastType = logs[0].type;
                const idx = WORKOUT_ORDER.indexOf(lastType);
                if (idx === -1) { todayType = "Torso"; } 
                else { todayType = WORKOUT_ORDER[(idx + 1) % WORKOUT_ORDER.length]; }
            }
            const todayIdx = WORKOUT_ORDER.indexOf(todayType);
            tomorrowType = WORKOUT_ORDER[(todayIdx + 1) % WORKOUT_ORDER.length];
        }

        function renderSession() {
            document.getElementById('today-title').innerText = todayType;
            const typeSelect = document.getElementById('inp-type');
            if(typeSelect) typeSelect.value = todayType;
            toggleDistField(todayType);

            const container = document.getElementById('session-content');
            const hrBox = document.getElementById('hr-box');
            document.getElementById('start-btn-container').style.display = 'block';

            if (todayType === "Aer√≥bico" || todayType === "Trekking") {
                let hrInfo = "";
                if(userAge > 0) {
                    const maxHr = 220 - userAge;
                    const z2Min = Math.round(maxHr * 0.6);
                    const z2Max = Math.round(maxHr * 0.7);
                    hrInfo = `<div class="hr-zone"><small>OBJETIVO: ZONA 2</small><span class="hr-val">${z2Min} - ${z2Max} <span style="font-size:14px">bpm</span></span></div>`;
                    hrBox.innerHTML = hrInfo; hrBox.style.display = 'block';
                } else {
                    hrBox.innerHTML = `<div class="hr-zone" style="color:#888; border-color:#444;"><small>‚ö†Ô∏è Actualiza tu edad al finalizar.</small></div>`;
                    hrBox.style.display = 'block';
                }
                container.innerHTML = `<div class="ex-card" style="padding:30px; display:block; text-align:center; border-color:var(--warning); color:var(--warning);"><div style="font-size:40px; margin-bottom:10px;">${todayType==="Trekking"?"üèîÔ∏è":"üèÉ"}</div><h3>${todayType}</h3><p style="color:#888; margin-top:10px;">Inicia el crono y disfruta.</p></div>`;
            } else {
                hrBox.style.display = 'none';
                const keys = ROUTINES[todayType];
                if (!keys) return;
                let html = "";
                keys.forEach(key => {
                    const ex = EXERCISES[key];
                    html += `<div class="ex-card"><img src="${ex.img}" class="ex-img" onclick="showInfo('${key}')"><div class="ex-hint">‚ÑπÔ∏è Ver Video</div><div class="ex-info"><div class="ex-name">${ex.name}</div><div class="ex-meta"><span>3 x ${currentReps}</span><span class="tag-rest">‚è≥ ${ex.rest}s</span></div></div></div>`;
                });
                container.innerHTML = html;
            }
            renderTomorrow();
        }

        function renderTomorrow() {
            document.getElementById('tmr-type').innerText = tomorrowType;
            const container = document.getElementById('tmr-icons');
            const keys = ROUTINES[tomorrowType];
            if(!keys || keys.length === 0) { container.innerHTML = `<span style="font-size:12px; color:#666;">D√≠a de Cardio / Actividad</span>`; } 
            else { container.innerHTML = keys.map(k => `<div class="mini-ex" onclick="showInfo('${k}')"><img src="${EXERCISES[k].img}" class="mini-img"><div>${EXERCISES[k].name.split(' ')[0]}</div></div>`).join(''); }
        }

        window.showInfo = (key) => {
            const ex = EXERCISES[key];
            if(!ex) return;
            document.getElementById('m-title').innerText = ex.name;
            document.getElementById('m-desc').innerText = ex.desc;
            document.getElementById('m-video').href = ex.video;
            document.getElementById('info-modal').style.display = 'flex';
        };
        window.closeModal = () => document.getElementById('info-modal').style.display = 'none';

        // --- UTILS FECHA ---
        function getLocalISO(date) {
            // Devuelve formato YYYY-MM-DDTHH:MM para input datetime-local
            const offset = date.getTimezoneOffset() * 60000;
            const localISOTime = (new Date(date - offset)).toISOString().slice(0, 16);
            return localISOTime;
        }

        // --- TIMER ---
        window.startWorkout = () => {
            document.getElementById('start-btn-container').classList.add('hidden');
            document.getElementById('finish-section').classList.add('visible');
            document.getElementById('global-timer-ui').classList.add('active');
            if(todayType !== "Aer√≥bico" && todayType !== "Trekking") { document.getElementById('panel-active').classList.add('visible'); }

            // Set current date automatically for new sessions
            document.getElementById('inp-date').value = getLocalISO(new Date());

            startTime = Date.now();
            if(globalInterval) clearInterval(globalInterval);
            globalInterval = setInterval(() => {
                const diff = Math.floor((Date.now() - startTime) / 1000);
                const m = Math.floor(diff / 60);
                const s = diff % 60;
                document.getElementById('global-timer-ui').innerText = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            }, 1000);
            setTimeout(() => { document.getElementById('finish-section').scrollIntoView({behavior: "smooth", block: "start"}); }, 300);
        };

        window.startRest = (sec) => {
            if(restInterval) clearInterval(restInterval);
            let left = sec;
            const display = document.getElementById('rest-display');
            display.style.color = "#fff"; display.innerText = `0:${left}`;
            restInterval = setInterval(() => {
                left--; const m = Math.floor(left/60); const s = left%60;
                display.innerText = `${m}:${s.toString().padStart(2,'0')}`;
                if(left <= 0) { clearInterval(restInterval); display.innerText = "¬°VAMOS!"; display.style.color = "var(--accent)"; navigator.vibrate([200, 100, 200]); }
            }, 1000);
        };

        window.toggleDistField = (val) => {
             const distContainer = document.getElementById('row-dist');
             if(val === "Aer√≥bico" || val === "Trekking") { distContainer.classList.remove('hidden'); } 
             else { distContainer.classList.add('hidden'); }
        };

        // --- SAVE / EDIT ---
        window.saveSession = async () => {
            const rpe = document.getElementById('inp-rpe').value;
            const w = document.getElementById('inp-weight').value;
            const age = document.getElementById('inp-age').value;
            const type = document.getElementById('inp-type').value;
            const durationInput = document.getElementById('inp-duration').value;
            const dateInput = document.getElementById('inp-date').value;
            
            const kcal = document.getElementById('inp-kcal').value || 0;
            const bpm = document.getElementById('inp-bpm').value || 0;
            const dist = document.getElementById('inp-dist').value || 0;

            if(!rpe || !w || !type || !durationInput) return alert("Completa Duraci√≥n, RPE y Peso.");

            const btn = document.getElementById('btn-finish'); btn.innerText = "Guardando...";
            let finalDuration = parseFloat(durationInput);
            let newLvl = userLevel;
            if(["Torso", "Pierna", "Full Body"].includes(type)) {
                if(parseInt(rpe) <= 6) newLvl++;
                else if(parseInt(rpe) >= 9 && userLevel > 1) newLvl--;
            }

            // Usar la fecha del input o la actual
            const finalDate = dateInput ? new Date(dateInput).toISOString() : new Date().toISOString();

            const data = {
                date: finalDate,
                type: type, rpe: parseInt(rpe), weight: parseFloat(w), duration: finalDuration, level: newLvl,
                kcal: parseInt(kcal), bpm: parseInt(bpm), dist: parseFloat(dist)
            };
            
            await setDoc(doc(db, "userStats", "global"), { level: newLvl, weight: parseFloat(w), age: parseInt(age) || 0 }, { merge: true });

            if(editingId) {
                await updateDoc(doc(db, "workouts", editingId), data);
                alert("Actualizado correctamente"); editingId = null;
            } else {
                await addDoc(collection(db, "workouts"), data);
                alert("¬°Guardado!");
            }
            location.reload();
        };

        window.editLog = (id, type, w, rpe, dur, kcal, bpm, dist, dateStr) => {
            switchTab('train');
            editingId = id;
            document.getElementById('start-btn-container').classList.add('hidden');
            document.getElementById('finish-section').classList.add('visible');
            
            // Populate Fields
            document.getElementById('inp-weight').value = w;
            document.getElementById('inp-rpe').value = rpe;
            document.getElementById('inp-type').value = type;
            document.getElementById('inp-duration').value = dur;
            if(userAge) document.getElementById('inp-age').value = userAge;
            document.getElementById('inp-kcal').value = kcal || "";
            document.getElementById('inp-bpm').value = bpm || "";
            document.getElementById('inp-dist').value = dist || "";
            
            // Set Date Field
            if(dateStr) {
                document.getElementById('inp-date').value = getLocalISO(new Date(dateStr));
            }

            toggleDistField(type);

            const btn = document.getElementById('btn-finish');
            btn.innerText = "ACTUALIZAR REGISTRO";
            btn.classList.add('update');
            document.getElementById('today-title').innerText = "Editando...";
            window.scrollTo({ top: 300, behavior: 'smooth' });
        };

        window.deleteLog = async(id) => { if(confirm("¬øBorrar?")) await deleteDoc(doc(db,"workouts",id)); };

        // --- DASHBOARD & ANALYTICS ---
        let chartFuerza = null;
        let chartCardio = null;

        function renderAnalytics(logs) {
            // Stats
            const totalKcal = logs.reduce((acc, curr) => acc + (curr.kcal || 0), 0);
            const avgRpe = logs.length ? (logs.reduce((acc,curr) => acc + (curr.rpe || 0), 0) / logs.length).toFixed(1) : 0;
            document.getElementById('stat-sessions').innerText = logs.length;
            document.getElementById('stat-kcal').innerText = totalKcal > 1000 ? (totalKcal/1000).toFixed(1) + 'k' : totalKcal;
            document.getElementById('stat-rpe').innerText = avgRpe;

            const sortedLogs = [...logs].reverse();
            const strLogs = sortedLogs.filter(l => ["Torso", "Pierna", "Full Body"].includes(l.type));
            const cardLogs = sortedLogs.filter(l => ["Aer√≥bico", "Trekking"].includes(l.type));

            // Chart Fuerza
            const ctxF = document.getElementById('chartFuerza').getContext('2d');
            if(chartFuerza) chartFuerza.destroy();
            chartFuerza = new Chart(ctxF, {
                type: 'line',
                data: {
                    labels: strLogs.map(l => new Date(l.date).getDate() + '/' + (new Date(l.date).getMonth()+1)),
                    datasets: [{ label: 'Peso (Kg)', data: strLogs.map(l => l.weight), borderColor: '#32d74b', backgroundColor: 'rgba(50, 215, 75, 0.1)', tension: 0.3, fill: true }]
                },
                options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { grid: { color: '#333' } }, x: { grid: { display: false } } } }
            });

            // Chart Cardio
            const ctxC = document.getElementById('chartCardio').getContext('2d');
            if(chartCardio) chartCardio.destroy();
            if(cardLogs.length > 0) {
                chartCardio = new Chart(ctxC, {
                    type: 'bar',
                    data: {
                        labels: cardLogs.map(l => new Date(l.date).getDate() + '/' + (new Date(l.date).getMonth()+1)),
                        datasets: [
                            { label: 'Dist (km)', data: cardLogs.map(l => l.dist || 0), backgroundColor: '#0a84ff', yAxisID: 'y', order: 2 },
                            { type: 'line', label: 'Pulso', data: cardLogs.map(l => l.bpm || 0), borderColor: '#ff453a', borderDash: [5, 5], tension: 0.4, yAxisID: 'y1', order: 1 }
                        ]
                    },
                    options: { responsive: true, plugins: { legend: { position: 'bottom', labels: { boxWidth: 10, color: '#888' } } }, scales: { y: { display: true, position: 'left', grid: { color: '#333' } }, y1: { display: true, position: 'right', grid: { display: false } }, x: { grid: { display: false } } } }
                });
            }

            // List (Updated with date param)
            document.getElementById('hist-list').innerHTML = logs.map(l => {
                let metrics = [];
                if(l.dist > 0) metrics.push(`üìè ${l.dist}km`);
                if(l.bpm > 0) metrics.push(`‚ù§Ô∏è ${l.bpm}`);
                if(l.kcal > 0) metrics.push(`üî• ${l.kcal}`);
                const metricStr = metrics.length ? " ¬∑ " + metrics.join(" ¬∑ ") : "";
                
                return `
                <div style="display:flex; justify-content:space-between; align-items:center; padding:15px 0; border-bottom:1px solid #333; font-size:13px;">
                    <div>
                        <b style="font-size:14px; color:white">${l.type}</b>
                        <br><span style="color:#666">${new Date(l.date).toLocaleDateString()} ¬∑ ${l.duration} min${metricStr}</span>
                    </div>
                    <div>
                        <button onclick='editLog("${l.id}", "${l.type}", ${l.weight}, ${l.rpe}, ${l.duration}, ${l.kcal||0}, ${l.bpm||0}, ${l.dist||0}, "${l.date}")' style="background:none; border:none; margin-right:15px; font-size:18px; cursor:pointer;">‚úèÔ∏è</button>
                        <button onclick="deleteLog('${l.id}')" style="color:#ff453a; background:none; border:none; font-size:18px; cursor:pointer;">‚úï</button>
                    </div>
                </div>`;
            }).join('');
        }

        window.switchTab = (t) => {
            document.querySelectorAll('.page').forEach(p=>p.classList.add('hidden'));
            document.getElementById('p-'+t).classList.remove('hidden');
            document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
            event.currentTarget.classList.add('active');
        };

        window.addEventListener('load', initApp);
    </script>
</head>
<body>

    <div id="info-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">√ó</button>
            <h2 id="m-title" style="margin-bottom:10px; color:white;">Nombre</h2>
            <p id="m-desc" style="color:#ccc; font-size:15px; line-height:1.5;">Descripci√≥n...</p>
            <a id="m-video" href="#" target="_blank" class="btn-video">üì∫ Ver Tutorial</a>
        </div>
    </div>

    <div id="p-train" class="page">
        <div class="top-bar">
            <div>
                <div style="font-size:10px; color:#888;">HOY TOCA</div>
                <h2 id="today-title">...</h2>
            </div>
            <div id="global-timer-ui" class="global-timer">00:00</div>
        </div>

        <div id="hr-box"></div>

        <div id="panel-active" class="active-panel">
            <div style="text-align:center; font-size:11px; color:#888; letter-spacing:1px; text-transform:uppercase;">Descanso</div>
            <div id="rest-display" class="rest-display">0:00</div>
            <div class="rest-controls">
                <button onclick="startRest(60)">60s</button>
                <button onclick="startRest(90)">90s</button>
                <button onclick="startRest(120)">2m</button>
            </div>
        </div>

        <div id="session-content"></div>

        <div class="tomorrow-box">
            <div class="tomorrow-title">üëÄ Pr√≥xima: <span id="tmr-type" style="color:white; font-weight:bold;"></span></div>
            <div id="tmr-icons" class="mini-grid"></div>
        </div>

        <div id="start-btn-container" class="sticky-action">
            <button class="btn-start" onclick="startWorkout()">‚ñ∂ COMENZAR SESI√ìN</button>
        </div>

        <div id="finish-section" class="finish-card">
            <h3 style="margin-bottom:5px;">Resumen Sesi√≥n</h3>
            <p style="color:#666; font-size:12px; margin-bottom:15px;">Copia los datos de tu Apple Watch</p>
            
            <label>Tipo</label>
            <select id="inp-type" onchange="toggleDistField(this.value)">
                <option value="Torso">Torso</option>
                <option value="Pierna">Pierna</option>
                <option value="Full Body">Full Body</option>
                <option value="Aer√≥bico">Aer√≥bico</option>
                <option value="Trekking">Trekking</option>
            </select>

            <div class="section-header">üìÖ FECHA Y HORA</div>
            <div class="form-row">
                <div style="flex:1">
                    <input type="datetime-local" id="inp-date" style="color-scheme: dark;">
                </div>
            </div>

            <div class="section-header">‚åö DATOS APPLE WATCH</div>
            <div class="form-row">
                <div style="flex:1">
                    <label>üî• Kcal</label>
                    <input type="number" id="inp-kcal" placeholder="Activas">
                </div>
                <div style="flex:1">
                    <label>‚ù§Ô∏è Pulsos (Media)</label>
                    <input type="number" id="inp-bpm" placeholder="BPM">
                </div>
            </div>
            <div class="form-row hidden" id="row-dist">
                <div style="flex:1">
                    <label>üìè Distancia (Km)</label>
                    <input type="number" id="inp-dist" step="0.01" placeholder="Km">
                </div>
            </div>

            <div class="section-header" style="margin-top:20px;">üë§ TUS DATOS</div>
            <div class="form-row">
                <div style="flex:1">
                    <label>‚è±Ô∏è Duraci√≥n (Min)</label>
                    <input type="number" id="inp-duration">
                </div>
                <div style="flex:1">
                    <label>üò∞ Esfuerzo (RPE)</label>
                    <select id="inp-rpe">
                        <option value="6">6 - F√°cil</option>
                        <option value="7">7 - Normal</option>
                        <option value="8">8 - Duro</option>
                        <option value="9">9 - M√°ximo</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div style="flex:1">
                    <label>‚öñÔ∏è Peso (Kg)</label>
                    <input type="number" id="inp-weight" step="0.1">
                </div>
                <div style="flex:1">
                    <label>üéÇ Edad</label>
                    <input type="number" id="inp-age">
                </div>
            </div>

            <button id="btn-finish" class="btn-save" onclick="saveSession()">GUARDAR SESI√ìN</button>
        </div>
    </div>

    <div id="p-anl" class="page hidden">
        <h1>Dashboard</h1>
        
        <div class="stat-grid">
            <div class="stat-box">
                <span id="stat-sessions" class="stat-num">0</span>
                <span class="stat-label">Sesiones</span>
            </div>
            <div class="stat-box">
                <span id="stat-kcal" class="stat-num" style="color:#ff2d55">0</span>
                <span class="stat-label">Kcal Total</span>
            </div>
            <div class="stat-box">
                <span id="stat-rpe" class="stat-num" style="color:var(--warning)">0</span>
                <span class="stat-label">RPE Medio</span>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-title">
                <span>üí™ Progreso Fuerza (Kg)</span>
                <span style="color:#32d74b; font-size:10px;">ULTIMAS SESIONES</span>
            </div>
            <canvas id="chartFuerza" height="150"></canvas>
        </div>

        <div class="chart-container">
            <div class="chart-title">
                <span>ü´Ä Eficiencia Cardio</span>
                <span style="color:#0a84ff; font-size:10px;">DIST vs PULSO</span>
            </div>
            <canvas id="chartCardio" height="150"></canvas>
        </div>

        <h3 style="margin-top:30px; margin-bottom:10px;">Historial Reciente</h3>
        <div id="hist-list" style="padding-bottom:50px;"></div>
    </div>

    <nav class="tab-bar">
        <button class="tab-btn active" onclick="switchTab('train')">ENTRENO</button>
        <button class="tab-btn" onclick="switchTab('anl')">DATOS</button>
    </nav>
</body>
</html>
