<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>BioHacker Dashboard Stable</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getFirestore, doc, setDoc,
      collection, query, orderBy, limit, onSnapshot, addDoc, deleteDoc
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // ---------------- Firebase config ----------------
    const firebaseConfig = {
      apiKey: "AIzaSyD1xdMdcbHXgGAL008bdmq22SNgLVcC9jM",
      authDomain: "appweb-entrenamiento.firebaseapp.com",
      projectId: "appweb-entrenamiento",
      storageBucket: "appweb-entrenamiento.firebasestorage.app",
      messagingSenderId: "199318318696",
      appId: "1:199318318696:web:04c592f117296e375215dd"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ---------------- Estilos (ORIGINAL) ----------------
    const styles = `
      :root { --primary: #0a84ff; --bg: #000; --card: #1c1c1e; --text: #fff; --accent: #30d158; --warning: #ffd60a; --danger: #ff453a; }
      body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; padding-bottom: 120px; }

      .card { background: var(--card); padding: 18px; border-radius: 20px; margin-bottom: 15px; border: 1px solid #2c2c2e; position: relative; }
      .section-dynamic { display: none; }
      .section-dynamic.active { display: block; animation: fadeIn 0.5s; }

      .grid-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px; }
      .stat-box { background: #2c2c2e; padding: 15px; border-radius: 15px; text-align: center; border: 1px solid #3a3a3c; }
      .stat-value { font-size: 24px; font-weight: 800; color: var(--text); }
      .stat-label { font-size: 10px; text-transform: uppercase; color: #8e8e93; }

      .week-container { display: flex; justify-content: space-between; align-items: center; background: #1c1c1e; padding: 15px; border-radius: 20px; margin-bottom: 20px; border: 1px solid #3a3a3c; }
      .dot { width: 10px; height: 10px; border-radius: 50%; background: #3a3a3c; margin-right: 5px; display: inline-block; }
      .dot.active { background: var(--accent); box-shadow: 0 0 5px var(--accent); }

      .btn-main { width: 100%; background: var(--primary); color: #fff; border: none; padding: 16px; border-radius: 14px; font-size: 16px; font-weight: 700; margin-top: 10px; cursor: pointer; }
      input, select { width: 100%; padding: 14px; border-radius: 12px; background: #121212; color: #fff; border: 1px solid #3a3a3c; margin-top: 8px; box-sizing: border-box; font-size: 16px; }

      .trekking-mode { border: 1px solid var(--warning); background: rgba(255, 214, 10, 0.1); color: #ffd60a; }

      .tab-bar { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(28,28,30,0.95); backdrop-filter: blur(20px); display: flex; padding: 15px; border-top: 0.5px solid #3a3a3c; z-index: 999; }
      .tab-btn { flex: 1; background: none; border: none; color: #8e8e93; font-size: 10px; font-weight: 600; }
      .tab-btn.active { color: var(--primary); }
      .hidden { display: none !important; }

      @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

      .checklist-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid #2c2c2e; }
      .cb { width: 20px; height: 20px; border: 2px solid #8e8e93; border-radius: 5px; margin-right: 10px; }
      .checked .cb { background: var(--primary); border-color: var(--primary); }
    `;
    const styleSheet = document.createElement("style");
    styleSheet.innerText = styles;
    document.head.appendChild(styleSheet);

    // ---------------- Estado ----------------
    let level = 1, reps = 10, weight = 72;
    let suggestedType = "Fuerza A";
    let timerInt, timeLeft;

    // Flags sencillos (anti-estancamiento/fatiga)
    let progFlags = { completed: false, veryHard: false };

    // Chart
    let chartInstance;

    // ---------------- Helpers ----------------
    const $ = (id) => document.getElementById(id);

    function isWeekend(d = new Date()) {
      const day = d.getDay();
      return day === 0 || day === 6;
    }

    function getMonday(d) {
      const dt = new Date(d);
      const day = dt.getDay() || 7;  // dom -> 7
      const monday = new Date(dt);
      monday.setDate(dt.getDate() - day + 1);
      monday.setHours(0,0,0,0);
      return monday;
    }

    function getSuggestedTypeByDay(d = new Date()) {
      // Plan recomendado: L Fuerza A, M Z2, X Movilidad, J Fuerza B, V Z2, finde Trekking
      const day = d.getDay(); // 0 dom ... 6 s√°b
      if (day === 0 || day === 6) return "Trekking";
      const idx = day - 1; // lun..vie => 0..4
      const pattern = ["Fuerza A", "Zona 2 (Cardio)", "Movilidad", "Fuerza B", "Zona 2 (Cardio)"];
      return pattern[idx] || "Movilidad";
    }

    function plannedWeekCount() { return 4; } // FuerzaA + Z2 + FuerzaB + Z2 (movilidad no cuenta)
    function isPlannedType(type) {
      return type === "Fuerza" || type === "Fuerza A" || type === "Fuerza B" || type === "Zona 2 (Cardio)";
    }

    function setFlagsUI() {
      $("f-completed").classList.toggle("checked", !!progFlags.completed);
      $("f-veryhard").classList.toggle("checked", !!progFlags.veryHard);
    }

    window.toggleFlag = (key) => {
      progFlags[key] = !progFlags[key];
      setFlagsUI();
    };

    function loadBioChecks() {
      const today = new Date().toLocaleDateString();
      const data = JSON.parse(localStorage.getItem('bioChecks') || '{}');
      if(data[today]) {
        if(data[today]['c1']) $('c1').classList.add('checked');
        if(data[today]['c2']) $('c2').classList.add('checked');
        if(data[today]['c3']) $('c3').classList.add('checked');
      }
    }

    window.toggleCheck = (id) => {
      const el = $(id);
      el.classList.toggle('checked');
      const data = JSON.parse(localStorage.getItem('bioChecks') || '{}');
      const today = new Date().toLocaleDateString();
      if(!data[today]) data[today] = {};
      data[today][id] = el.classList.contains('checked');
      localStorage.setItem('bioChecks', JSON.stringify(data));
    };

    // ---------------- Rutinas (texto gu√≠a) ----------------
    function routineFor(type) {
      if (type === "Fuerza A") {
        return [
          "Calentamiento 6 min (movilidad + 2 rondas suaves).",
          "Circuito 3‚Äì4 rondas (60‚Äì90s descanso).",
          "1) Flexiones 6‚Äì15 (RPE 7‚Äì8).",
          "2) Split squat 8‚Äì12/ pierna.",
          "3) Puente gl√∫teo 12‚Äì20.",
          "4) Plancha 30‚Äì60s."
        ];
      }
      if (type === "Fuerza B") {
        return [
          "Calentamiento 6 min.",
          "Circuito 3‚Äì4 rondas (60‚Äì90s descanso).",
          "1) Remo con mochila (o isom√©trico toalla) 8‚Äì15.",
          "2) RDL a una pierna 8‚Äì12/ pierna.",
          "3) Pike push-up 6‚Äì12 (o flexi√≥n inclinada).",
          "4) Dead bug 8‚Äì12/ lado."
        ];
      }
      if (type === "Zona 2 (Cardio)") {
        return [
          "Zona 2 30‚Äì40 min (ritmo conversacional).",
          "Opciones: caminar r√°pido, bici est√°tica, escaleras suave.",
          "Si est√°s cansado: 20‚Äì30 min + movilidad 5‚Äì10 min."
        ];
      }
      if (type === "Movilidad") {
        return [
          "Movilidad 15‚Äì25 min.",
          "Cadera + tobillo + tor√°cica.",
          "Respiraci√≥n 2‚Äì3 min + estiramientos suaves."
        ];
      }
      // Trekking
      return [
        "Trekking a ritmo c√≥modo.",
        "Anota minutos, desnivel y RPE (si quieres).",
        "Hidrataci√≥n + snack sencillo."
      ];
    }

    function renderRoutineBox(type) {
      const box = $("routine-box");
      if (!box) return;
      const lines = routineFor(type);
      box.innerHTML =
        `<div style="font-size:10px; color:#888; text-transform:uppercase; margin-top:12px;">RUTINA HOY</div>` +
        `<ul style="margin:8px 0 0 18px; padding:0;">` +
          lines.map(x => `<li style="margin:6px 0; font-size:13px; color:#d1d1d6;">${x}</li>`).join("") +
        `</ul>`;
    }

    // ---------------- Guardar sesi√≥n ----------------
    window.saveSession = async () => {
      const rpe = parseInt($('input-rpe').value || "0", 10);
      const w = parseFloat($('input-weight').value || "0");
      const minutes = parseInt($('input-minutes').value || "0", 10);
      const elev = parseInt($('input-elev').value || "0", 10);

      suggestedType = getSuggestedTypeByDay(new Date());

      if (!w || w < 30) return alert("Por favor, rellena Peso (kg).");
      if (!minutes || minutes < 5) return alert("Por favor, rellena Duraci√≥n (min).");
      if (minutes > 40) return alert("M√°ximo 40 min.");

      const needsRPE = !(suggestedType === "Movilidad"); // movilidad puede ir sin RPE
      if (needsRPE && (!rpe || rpe < 1) && suggestedType !== "Trekking") {
        return alert("Por favor, rellena RPE.");
      }

      const btn = $('btn-save');
      btn.innerText = "Guardando...";
      btn.disabled = true;

      await addDoc(collection(db, "workouts"), {
        date: new Date().toISOString(),
        type: suggestedType,
        rpe: (suggestedType === "Trekking" && !rpe) ? 0 : rpe,
        weight: w,
        durationMin: minutes,
        elevM: (suggestedType === "Trekking") ? (elev || 0) : 0,
        completed: !!progFlags.completed,
        veryHard: !!progFlags.veryHard
      });

      // stats (tu l√≥gica original, pero sin reload)
      let updateData = { weight: w };
      if ((suggestedType.includes("Fuerza") || suggestedType === "Fuerza") && rpe && rpe <= 6 && progFlags.completed && !progFlags.veryHard) {
        reps++;
        if (reps > 15) { reps = 10; level++; }
        updateData.level = level;
        updateData.reps = reps;
      }
      await setDoc(doc(db, "userStats", "global"), updateData, { merge: true });

      // reset inputs/flags
      $('input-rpe').value = "";
      $('input-minutes').value = "";
      $('input-elev').value = "";

      progFlags = { completed: false, veryHard: false };
      setFlagsUI();

      btn.innerText = "REGISTRAR SESI√ìN";
      btn.disabled = false;

      alert("¬°Guardado!");
    };

    // ---------------- Timer ----------------
    window.startTimer = (s) => {
      clearInterval(timerInt);
      timeLeft = s;
      const display = $('timer-val');
      display.innerText = `0:00`;
      timerInt = setInterval(() => {
        timeLeft--;
        const m = Math.floor(timeLeft/60);
        const sec = timeLeft%60;
        display.innerText = `${m}:${sec.toString().padStart(2,'0')}`;
        if(timeLeft<=0) { clearInterval(timerInt); if (navigator.vibrate) navigator.vibrate(200); }
      }, 1000);
    };

    // ---------------- Semana / historial ----------------
    function renderWeekProgress(logs) {
      const now = new Date();
      const monday = getMonday(now);

      const planned = plannedWeekCount();

      const weekLogs = logs
        .filter(l => new Date(l.date) >= monday)
        .filter(l => {
          const d = new Date(l.date);
          const wd = d.getDay();
          return wd >= 1 && wd <= 5;
        })
        .filter(l => isPlannedType(l.type));

      const count = weekLogs.length;

      $('week-dots').innerHTML = Array(planned).fill(0).map((_,i) =>
        `<span class="dot ${i<count?'active':''}"></span>`
      ).join('');
      $('week-text').innerText = `${count}/${planned} Sesiones`;
    }

    function renderHistory(logs) {
      $('history-list').innerHTML = logs.map(l => `
        <div style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #333; font-size:13px;">
          <div>
            <b>${l.type || "-"}</b><br>
            <span style="color:#888">
              ${new Date(l.date).toLocaleDateString()}
              ¬∑ ${l.durationMin ? (l.durationMin + " min") : "‚Äî"}
              ¬∑ ${l.rpe ? ("RPE " + l.rpe) : "‚Äî"}
              ${l.type === "Trekking" && l.elevM ? (" ¬∑ +" + l.elevM + "m") : ""}
              ${l.completed ? " ¬∑ ‚úÖ" : ""}
              ${l.veryHard ? " ¬∑ ‚ö†Ô∏è" : ""}
            </span>
          </div>
          <button onclick="deleteLog('${l.id}')" style="background:none; border:1px solid #ff453a; color:#ff453a; border-radius:5px; padding:2px 10px;">X</button>
        </div>
      `).join('');
    }

    window.deleteLog = async(id) => {
      if(confirm("¬øBorrar?")) await deleteDoc(doc(db,"workouts",id));
    };

    // ---------------- KPIs ‚Äú¬øvoy bien?‚Äù ----------------
    function computeWeeklyKPIs(logs) {
      const now = new Date();
      const monday = getMonday(now);
      const weekLogs = logs.filter(l => new Date(l.date) >= monday);

      const strength = weekLogs.filter(l => (l.type || "").includes("Fuerza")).length;

      const aeroMin = weekLogs
        .filter(l => l.type === "Zona 2 (Cardio)" || l.type === "Trekking")
        .reduce((acc, l) => acc + Number(l.durationMin || 0), 0);

      const planned = plannedWeekCount();
      const donePlanned = weekLogs
        .filter(l => {
          const d = new Date(l.date);
          const wd = d.getDay();
          return wd >= 1 && wd <= 5;
        })
        .filter(l => isPlannedType(l.type)).length;

      const adherence = planned ? Math.min(100, Math.round(100 * donePlanned / planned)) : 0;

      // Carga interna sRPE (RPE * minutos)
      const load = weekLogs.reduce((acc, l) => acc + (Number(l.rpe || 0) * Number(l.durationMin || 0)), 0);

      // Fatiga: % de sesiones "muy duras" (flag o RPE>=9)
      const totalSessions = weekLogs.length || 1;
      const hardCount = weekLogs.filter(l => l.veryHard || Number(l.rpe || 0) >= 9).length;
      const hardPct = Math.round(100 * hardCount / totalSessions);

      // Sem√°foro simple
      const strengthStatus = strength >= 2 ? "green" : strength === 1 ? "yellow" : "red";
      const aeroStatus = aeroMin >= 150 ? "green" : aeroMin >= 90 ? "yellow" : "red";

      return { strength, aeroMin, adherence, load, hardPct, strengthStatus, aeroStatus };
    }

    function colorFor(status) {
      if (status === "green") return "var(--accent)";
      if (status === "yellow") return "var(--warning)";
      return "var(--danger)";
    }

    function renderKPIs(k) {
      const box = $("kpi-box");
      if (!box) return;

      box.innerHTML = `
        <div class="stat-box">
          <div class="stat-value" style="color:${colorFor(k.strengthStatus)}">${k.strength}</div>
          <div class="stat-label">Fuerza/sem</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" style="color:${colorFor(k.aeroStatus)}">${k.aeroMin}</div>
          <div class="stat-label">Min aer√≥bicos/sem</div>
        </div>
        <div class="stat-box">
          <div class="stat-value">${k.adherence}%</div>
          <div class="stat-label">Adherencia</div>
        </div>
        <div class="stat-box">
          <div class="stat-value">${k.load}</div>
          <div class="stat-label">Carga sRPE</div>
        </div>
      `;

      const msg = $("coach-msg");
      if (msg) {
        const rec =
          (k.strengthStatus === "green" && k.aeroStatus === "green")
            ? "Vas muy bien: consistencia + base aer√≥bica en rango."
            : (k.strengthStatus !== "green" && k.aeroStatus === "green")
              ? "Prioriza 2 sesiones de fuerza/semana (m√≠nimo)."
              : (k.strengthStatus === "green" && k.aeroStatus !== "green")
                ? "Suma minutos de Z2/trekking (objetivo 150 min/semana)."
                : "Semana baja: busca al menos 2 fuerza y 90‚Äì150 min aer√≥bicos.";

        const fatigueNote = (k.hardPct >= 40) ? " Fatiga alta: si se repite, reduce volumen 1 semana." : "";
        msg.innerText = rec + fatigueNote;
      }
    }

    // ---------------- Chart semanal (combo: barras + l√≠nea) ----------------
    function getWeekKey(dateObj) {
      const d = new Date(dateObj);
      const day = d.getDay() || 7;
      const monday = new Date(d);
      monday.setDate(d.getDate() - day + 1);
      monday.setHours(0,0,0,0);
      return monday.toISOString().slice(0,10);
    }

    function updateChart(logs) {
      const ctx = $('chart').getContext('2d');

      // agrupar por semana (√∫ltimas ~10 semanas)
      const byWeek = new Map();
      const sorted = [...logs].sort((a,b) => new Date(a.date) - new Date(b.date));

      sorted.forEach(l => {
        const key = getWeekKey(l.date);
        if (!byWeek.has(key)) byWeek.set(key, { aero: 0, strength: 0, rpeSum: 0, rpeN: 0 });

        const w = byWeek.get(key);
        const min = Number(l.durationMin || 0);

        if (l.type === "Zona 2 (Cardio)" || l.type === "Trekking") w.aero += min;
        if ((l.type || "").includes("Fuerza")) w.strength += 1;

        const r = Number(l.rpe || 0);
        if (r > 0) { w.rpeSum += r; w.rpeN += 1; }
      });

      const labels = [...byWeek.keys()].slice(-10); // √∫ltimas 10 semanas
      const aero = labels.map(k => byWeek.get(k).aero);
      const strength = labels.map(k => byWeek.get(k).strength);
      const rpeAvg = labels.map(k => {
        const w = byWeek.get(k);
        return w.rpeN ? Number((w.rpeSum / w.rpeN).toFixed(1)) : 0;
      });

      if(chartInstance) chartInstance.destroy();

      chartInstance = new Chart(ctx, {
         {
          labels,
          datasets: [
            { type: 'bar', label: 'Min Z2+Trek',  aero, backgroundColor: 'rgba(48, 209, 88, 0.35)' },
            { type: 'bar', label: 'Fuerza (sesiones)',  strength, backgroundColor: 'rgba(10, 132, 255, 0.35)' },
            { type: 'line', label: 'RPE medio',  rpeAvg, borderColor: '#ffd60a', tension: 0.3, yAxisID: 'y2' }
          ]
        },
        options: {
          plugins: { legend: { display: true, labels: { color: '#e5e5ea', boxWidth: 10 } } },
          scales: {
            x: { ticks: { display: false }, grid: { display: false } },
            y: { ticks: { display: false }, grid: { display: false }, beginAtZero: true },
            y2: { position: 'right', ticks: { display: false }, grid: { drawOnChartArea: false }, min: 0, max: 10 }
          }
        }
      });
    }

    // ---------------- Tabs (fix) ----------------
    window.switchTab = (t, ev) => {
      document.querySelectorAll('.page').forEach(p=>p.classList.add('hidden'));
      $('p-'+t).classList.remove('hidden');
      document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
      if (ev?.currentTarget) ev.currentTarget.classList.add('active');
    };

    // ---------------- Init ----------------
    window.initApp = async () => {
      loadBioChecks();
      setFlagsUI();

      // Stats y 1RM (tu l√≥gica original)
      onSnapshot(doc(db, "userStats", "global"), (docSnap) => {
        if(docSnap.exists()) {
          const d = docSnap.data();
          level = d.level || 1;
          reps = d.reps || 10;
          weight = d.weight || 72;

          $('lvl-val').innerText = level;
          $('input-weight').value = weight;

          // 1RM estimado (Epley) sobre "peso" (en tu app lo usamos como indicador gamificado)
          const oneRM = Math.round(weight * (1 + (reps / 30)));
          $('rm-val').innerText = oneRM + "kg";
        }
      });

      // Workouts
      onSnapshot(query(collection(db, "workouts"), orderBy("date", "desc"), limit(120)), (snapshot) => {
        const logs = snapshot.docs.map(d => ({id: d.id, ...d.data()}));

        renderHistory(logs.slice(0, 30));
        renderWeekProgress(logs);
        updateChart(logs);

        // Contexto d√≠a (determinista)
        const wknd = isWeekend(new Date());
        suggestedType = getSuggestedTypeByDay(new Date());
        $('global-title').innerText = suggestedType;

        if (wknd) {
          $('panel-weekday').classList.remove('active');
          $('panel-weekend').classList.add('active');

          const w = parseFloat($('input-weight').value) || 72;
          $('trek-water').innerText = (w * 0.035).toFixed(1) + " L";

          $('input-elev').classList.remove('hidden');
        } else {
          $('panel-weekend').classList.remove('active');
          $('panel-weekday').classList.add('active');

          $('input-elev').classList.add('hidden');

          // T√≠tulo y rutina
          $('gym-instruction').innerText =
            suggestedType === "Zona 2 (Cardio)" ? "üèÉ Objetivo: Cardio Suave (‚â§40min)" :
            suggestedType === "Fuerza A" ? "üèãÔ∏è Objetivo: Fuerza A (‚â§40min)" :
            suggestedType === "Fuerza B" ? "üèãÔ∏è Objetivo: Fuerza B (‚â§40min)" :
            "üßò Objetivo: Movilidad (15‚Äì25min)";

          renderRoutineBox(suggestedType);
        }

        // KPIs (p√°gina an√°lisis)
        const kpis = computeWeeklyKPIs(logs);
        renderKPIs(kpis);
      });
    };

    window.addEventListener('load', initApp);
  </script>
</head>

<body>

  <div id="p-dash" class="page">

    <div class="week-container">
      <div>
        <div style="font-size:10px; color:#888;">SEMANA ACTUAL</div>
        <div id="week-text" style="font-weight:bold;">0/4 Sesiones</div>
      </div>
      <div id="week-dots"></div>
    </div>

    <div class="grid-stats">
      <div class="stat-box">
        <div class="stat-value" id="lvl-val">-</div>
        <div class="stat-label">Nivel</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" style="color:var(--accent)" id="rm-val">-</div>
        <div class="stat-label">1RM Est.</div>
      </div>
    </div>

    <h2 id="global-title" style="margin:10px 0;">Cargando...</h2>

    <div id="panel-weekend" class="card trekking-mode section-dynamic">
      <h3 style="margin:0;">üèîÔ∏è Modo Monta√±a</h3>
      <p>Hidrataci√≥n sugerida: <b id="trek-water">--</b></p>
      <div style="font-size:12px; margin-top:5px; border-top:1px solid var(--warning); padding-top:5px;">
        ü•§ <b>Isot√≥nico:</b> Agua + Lim√≥n + Sal + Miel.
      </div>
    </div>

    <div id="panel-weekday" class="card section-dynamic">
      <h3 style="margin:0;" id="gym-instruction">Entrenamiento</h3>
      <div style="display:flex; justify-content:space-between; margin-top:15px; align-items:center;">
        <span id="timer-val" style="font-size:24px; font-family:monospace; color:var(--primary);">0:00</span>
        <div style="display:flex; gap:5px;">
          <button onclick="startTimer(60)" style="background:#333; color:#fff; border:none; padding:5px 10px; border-radius:5px;">1'</button>
          <button onclick="startTimer(90)" style="background:#333; color:#fff; border:none; padding:5px 10px; border-radius:5px;">1.5'</button>
          <button onclick="startTimer(120)" style="background:#333; color:#fff; border:none; padding:5px 10px; border-radius:5px;">2'</button>
        </div>
      </div>

      <!-- NUEVO: rutina del d√≠a (misma est√©tica) -->
      <div id="routine-box"></div>
    </div>

    <div class="card" style="border: 1px solid var(--primary);">
      <div style="font-size:10px; color:#888; text-transform:uppercase; margin-bottom:5px;">Registrar Actividad</div>

      <input type="number" id="input-weight" step="0.1" placeholder="Peso (kg)">

      <!-- NUEVO: duraci√≥n -->
      <input type="number" id="input-minutes" step="1" placeholder="Duraci√≥n (min) ‚Äî m√°x 40">

      <!-- NUEVO: desnivel (solo trekking; se muestra/oculta con hidden) -->
      <input type="number" id="input-elev" step="10" placeholder="Desnivel (m) (solo trekking)" class="hidden">

      <select id="input-rpe">
        <option value="">Nivel de Esfuerzo (RPE)</option>
        <option value="6">6 - C√≥modo</option>
        <option value="7">7 - √ìptimo</option>
        <option value="8">8 - Duro</option>
        <option value="9">9 - M√°ximo</option>
      </select>

      <!-- NUEVO: flags para ‚Äúprogreso‚Äù y fatiga (sin cambiar tu est√©tica) -->
      <div class="card" style="padding:0; margin-top:12px; border:1px solid #2c2c2e; background:#1c1c1e;">
        <div class="checklist-item" id="f-completed" onclick="toggleFlag('completed')"><div class="cb"></div>Completado (dentro de rango)</div>
        <div class="checklist-item" id="f-veryhard" onclick="toggleFlag('veryHard')"><div class="cb"></div>Muy duro / fatiga</div>
      </div>

      <button id="btn-save" class="btn-main" onclick="saveSession()">REGISTRAR SESI√ìN</button>
    </div>

    <div class="card">
      <div class="checklist-item" id="c1" onclick="toggleCheck('c1')"><div class="cb"></div>Creatina</div>
      <div class="checklist-item" id="c2" onclick="toggleCheck('c2')"><div class="cb"></div>+7h Sue√±o</div>
      <div class="checklist-item" id="c3" onclick="toggleCheck('c3')"><div class="cb"></div>Sol / Naturaleza</div>
    </div>

  </div>

  <div id="p-stats" class="page hidden">
    <h1>An√°lisis</h1>

    <!-- NUEVO: KPIs (mismo look stat-box) -->
    <div id="kpi-box" class="grid-stats"></div>
    <div class="card" style="margin-top:10px;">
      <div style="font-size:10px; color:#888; text-transform:uppercase; margin-bottom:6px;">COACH</div>
      <div id="coach-msg" style="font-size:13px; color:#d1d1d6;">‚Äî</div>
    </div>

    <div class="card"><canvas id="chart" height="150"></canvas></div>
    <div class="card" id="history-list"></div>
  </div>

  <nav class="tab-bar">
    <button class="tab-btn active" onclick="switchTab('dash', event)">DASHBOARD</button>
    <button class="tab-btn" onclick="switchTab('stats', event)">AN√ÅLISIS</button>
  </nav>

</body>
</html>
